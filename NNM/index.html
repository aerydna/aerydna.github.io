<html>

<head>
    <meta charset="utf-8">
    <title>Waveform Playlist Basic HTML</title>
    <link rel="stylesheet" href="https://unpkg.com/waveform-playlist@4.2.2/styles/playlist.css">
    <script src="https://kit.fontawesome.com/ef69927139.js" crossorigin="anonymous"></script>
</head>

<body>
    <button type="button" id="btn-play" title="Play">
        <i class="fas fa-play"></i>
    </button>
    <button type="button" id="btn-pause" title="Pause">
        <i class="fas fa-pause"></i>
    </button>
    <button type="button" id="btn-zoom-in"  title="Zoom In"><i class="fas fa-magnifying-glass-plus"></i></button>
    <button type="button" id="btn-zoom-out" title="Zoom Out"><i class="fas fa-magnifying-glass-minus"></i></button>
    <input id="zoom-slider" type="range" min="0" max="6" step="1" value="2" style="vertical-align: middle; width: 200px;">
    <div id="playlist"></div>
    <script src="https://unpkg.com/waveform-playlist@4.2.2/build/waveform-playlist.var.js"></script>
    <script src="jszip.js"></script>
    <script>
        const ZOOM_LEVELS = [64, 128, 256, 512, 1024, 2048, 4096, 8192, 16384]; // personalizzabile
        const INITIAL_ZOOM_INDEX = 8; // 256
        var playlist = WaveformPlaylist.init({
            container: document.getElementById("playlist"),
            samplesPerPixel: ZOOM_LEVELS[INITIAL_ZOOM_INDEX],
            zoomLevels: ZOOM_LEVELS,
            controls: { show: true }
        });
        const zoomInBtn   = document.getElementById("btn-zoom-in");
        const zoomOutBtn  = document.getElementById("btn-zoom-out");
        const zoomSlider  = document.getElementById("zoom-slider");
        zoomSlider.max    = ZOOM_LEVELS.length - 1;
        zoomSlider.value  = INITIAL_ZOOM_INDEX;

        // stato corrente (manteniamo lâ€™indice)
        let currentZoomIdx = INITIAL_ZOOM_INDEX;

        // helper per portarsi a un indice specifico usando gli eventi nativi
        function attachZoomHandlers(ee) {
        function setZoomTo(targetIdx) {
            targetIdx = Math.max(0, Math.min(ZOOM_LEVELS.length - 1, targetIdx));
            const steps = targetIdx - currentZoomIdx;
            if (steps === 0) return;

            const emit = steps > 0 ? () => ee.emit("zoomout") : () => ee.emit("zoomin");
            for (let i = 0; i < Math.abs(steps); i++) emit();   // avanza tra i livelli
            currentZoomIdx = targetIdx;
            zoomSlider.value = currentZoomIdx;
        }

        zoomInBtn.onclick  = () => setZoomTo(currentZoomIdx - 1);
        zoomOutBtn.onclick = () => setZoomTo(currentZoomIdx + 1);
        zoomSlider.oninput = (e) => setZoomTo(parseInt(e.target.value, 10));

        // zoom con CTRL + rotellina direttamente sopra il playlist container
        const container = document.getElementById("playlist");
        container.addEventListener("wheel", (ev) => {
            if (!ev.ctrlKey) return; // evita conflitti con lo scroll normale
            ev.preventDefault();
            if (ev.deltaY < 0) zoomInBtn.click();
            else zoomOutBtn.click();
        }, { passive: false });
        }
        
        function loadSong(song){
            playlist.clear();
            function partUrl(inst){
                return "./" + song + "/" + inst + ".mp3";
            };

            playlist.load(
            [
                { src:  partUrl("VOICES") },
                { src: partUrl("GUITAR") },
                { src: partUrl("BASS") },
                { src: partUrl("DRUM") },
                { src: partUrl("KEY") },
                { src: partUrl("CLICK") } ]
            ).then(() => {
                var ee = playlist.getEventEmitter();

                document.getElementById("btn-play").addEventListener("click", () => {
                    ee.emit("play");
                });

                document.getElementById("btn-pause").addEventListener("click", () => {
                    ee.emit("pause");
                });

                ee.emit("automaticscroll", true);
                attachZoomHandlers(ee);

                
            });
        }
    </script>
    <button onclick="{loadSong('01')}">Overcoming</button>
    <button onclick="{loadSong('02')}">Beyond The World</button>
    <button onclick="{loadSong('03')}">Rook</button>
    <button onclick="{loadSong('04')}">Power on Insanity</button>
    <button onclick="{loadSong('05')}">H.P.JungleMan</button>
    <button onclick="{loadSong('06')}">Inferno</button>
    <button onclick="{loadSong('07')}">... to a million miles away</button>
    <button onclick="{loadSong('08')}">Showdown of Fate</button>
    <button onclick="{loadSong('09')}">Bishop</button>
</body>

</html>